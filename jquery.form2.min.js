/*!*
 * jQuery plugin for validate and get/post form data to server (jquery.form2) plugin v0.1
 * Copyright (c) 2014 Duc Doan Hoang Minh
 *
 * @license https://github.com/bobkhin/jquery.form2/blob/master/LICENSE
 *
 * Date: Mon, May 19th, 2014 (GTM+7)
 */
!function(a,b){a.form2=function(b,c){return a(b).form(c)},a.form2.debug=!0;var c=a.form2.logArray=function(){a.form2.debug&&console&&console.log&&("Microsoft Internet Explorer"==navigator.appName?1==arguments.length?console.log(arguments[0]):2==arguments.length?console.log(arguments[0],arguments[1]):3===arguments.length?console.log(arguments[0],arguments[1],arguments[2]):console.log(arguments[0],arguments[1],arguments[2],arguments[3]):console.log(arguments))};a.form2.rules={},a.form2.addRule=function(b,c){var d=a.form2.rules[b]||{};a.form2.rules[b]=a.extend({},d,c)},a.form2.removeRule=function(b){delete a.form2.rules[b]},a.form2.applyRule=function(b,c,d){var e=a(b);d.requiredIf===!0&&(e.attr("data-required-if",!0),delete d.requiredIf),e.attr("data-form2",c);for(var f in d)e.attr("data-"+optionsName,d[f]);return e},a.form2.dashToCamel=function(a){return a.replace(/(\-[a-z])/g,function(a){return a.toUpperCase().replace("-","")})},a.form2.underscoreToCamel=function(a){return a.replace(/(\_[a-z])/g,function(a){return a.toUpperCase().replace("_","")})},a.form2.camelToDash=function(a){return a.replace(/([A-Z])/g,function(a){return"-"+a.toLowerCase()})},a.form2.camelToUnderscore=function(a){return a.replace(/([A-Z])/g,function(a){return"_"+a.toLowerCase()})},a.form2.dashToSpace=function(a){return a.replace(/\-/g," ")},a.form2.underscoreToSpace=function(a){return a.replace(/\_/g," ")},a.form2.capitalise=function(a,b){return b?a.replace(/(^|\s)([a-z])/g,function(a,b,c){return b+c.toUpperCase()}):a.charAt(0).toUpperCase()+a.slice(1)},a.form2.generatePasswordRegex=function(a){var b="(?=(?:.*[a-z]){1})";return a.uppercaseLength>0&&(b+="(?=(?:.*[A-Z]){"+a.uppercaseLength+"})"),a.numberLength>0&&(b+="(?=(?:.*\\d){"+a.numberLength+"})"),a.specialLength>0&&(b+="(?=(?:.*["+a.specialCharacter+"]){"+a.numberLength+"})"),b+=".{"+a.min+","+a.max+"}",new RegExp("^"+b+"$")},a.form2.formatString=function(a){var b=arguments,c=new RegExp("{([0-"+arguments.length+"])}","g");return a.replace(c,function(a,c){return b[+c+1]})};var d={preventDefault:!0,whenInvalid:null,whenValid:null,beforeValidate:null,beforeSubmit:null,ignoreHidden:!1,trimValue:{enable:!0,ignorePassword:!0},ajaxOptions:{enable:!0,type:"POST",dataType:"JSON",data:null},format:{date:"DD-MM-YYYY",time:"HH:mm",datetime:"DD-MM-YYYY HH:mm"},password:{min:8,max:32,specialCharacter:"!@#$%^&*-",specialLength:1,uppercaseLength:1,numberLength:1,errorMessage:"must be between 8 and 32 characters long; contain a number, an uppercase letter and one of following special characters <b>!@#$%^&*-</b>"},regex:{email:/^([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22))*\x40([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d))*$/,url:/^(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)*\/?$/,hex:/^#?([a-f0-9]{6}|[a-f0-9]{3})$/,ip:/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)(:\d{2,5}){0,1}$/},getControlName:function(b,c){var d=b.attr("id")||b.attr("name"),e=c.find("label[for="+d+"]");if(e[0])return e.html().replace(":","");var f=b.attr("name");if(f){if(f.indexOf("-")>0)return a.form2.capitalise(a.form2.dashToSpace(f),!0);if(f.indexOf("_")>0)return a.form2.capitalise(a.form2.underscoreToSpace(f),!0);if(f)return a.form2.capitalise(a.form2.dashToSpace(a.form2.camelToDash(f)),!0)}return b.attr("data-name")||""},errorHandler:function(b,d){c("Error control",b,d);var e=b.next(".help-block");e[0]?e.show():b.after(a.form2.formatString('<span class="help-block">{0}</span>',d))},successHandler:function(a){c("Success control",a);var b=a.closest(".form-group");b.removeClass("has-error"),b.find(".help-block").hide()}},e={init:function(b){var c=a(this);if(!a.isPlainObject(c.data("options")))return b=a.extend(!0,{},d,b),c.data("options",b),c.on("submit",function(d){"function"==typeof b.beforeValidate&&b.beforeValidate.call(this,c,b);var f=e.validate.call(this,b),g=f[0],h=f[1],i=f[2],j=f[3];if("function"==typeof b.successHandler)for(var k,l=0;k=j[l];l++)b.successHandler.call(k,k,c,b);if(0===i.length){if("function"==typeof b.whenValid&&b.whenValid.call(this,b),"function"==typeof b.beforeSubmit&&b.beforeSubmit.call(this,g,c,b),b.preventDefault){d.preventDefault();var m=b.ajaxOptions;m.enable&&(m.data=a.extend({},g,b.ajaxOptions.data||{}),m.url||(m.url=c.attr("action")),m.type||(m.type=c.attr("method")),a.ajax(m))}}else{if(d.preventDefault(),"function"==typeof b.errorHandler)for(var n,l=0;n=h[l];l++)b.errorHandler.call(n,n,i[l],c,b);"function"==typeof b.whenInvalid&&b.whenInvalid.call(this,b)}}),c},reset:function(){var b=a(this);return b.get(0).reset(),b},clear:function(c){var d=a(this),e=null;return e=d.find(c===b?"input, textarea, select":c),e.each(function(){var b=a(this),c=b.is("select"),d=b.is(":checkbox"),e=b.is(":radio");c?this.selectedIndex=-1:d||e?b.attr("checked",!1):b.val("")}),d},disable:function(){var b=a(this);return c("Disable form: ",b),b.find("input, button, textarea, select").attr("disabled",!0),b},enable:function(){var b=a(this);return c("Enable form: ",b),b.find("input, button, textarea, select").attr("disabled",!1),b},validate:function(d){var f=a(this),g=e.getControls.call(f,!0),h={},i=[],j=[],k=[];c("Validate form: ",f);var l=function(a){var b=a.is(":disabled");return b&&c("Is ignored",a),b},m=function(b,d,e,f){c("Name is: "+b,"Value is: "+(a.isArray(d)?d.join(", "):d),"Rule name is: "+e,f)},n=function(e,f,g,l,m){if(e!==b)if(d.ignoreHidden&&f.is(":hidden"))c("Control is hidden and will be not validated",f),k.push(f),f.attr("data-success",!0);else{var n=!1;-1!==e.indexOf("|")&&(e=e.split("|"),n="requiredIf"===e[1],e=e[0]);var o=a.form2.rules[e];if(o){var p=o.validate(f,l,d,m);n&&(p=l?p:!0),p?(k.push(f),f.attr("data-success",!0)):(f.attr("data-success",!1),i.push(f),j.push(o.message(f,g,d,m)))}else c(e+" is not existed in rules!",f)}h[f.attr("name")]=l},o=g.textboxes;o.each(function(){var b=a(this),c=b.is(":password"),e=b.val();if(d.trimValue.enable&&(e=c&&d.trimValue.ignorePassword?e:e.trim()),!l(b)){var g=d.getControlName(b,f),h=b.attr("data-form2");m(g,e,h,b),n(h,b,g,e)}});var p=g.checkboxes;for(var q in p){var r=p[q];if(d.ignoreHidden&&(r=r.not(":hidden")),r.length>0){var s=r.filter("[data-form2]");s=s[0]?s.eq(0):r.eq(0);var t=d.getControlName(s,f),u=s.attr("data-form2"),v=[];r.filter(":checked").each(function(){v.push(this.value)}),m(t,v,u,r),n(u,r,t,v,"checkbox")}}var w=g.radios;for(var q in w){var r=w[q];if(d.ignoreHidden&&(r=r.not(":hidden")),r.length>0){var s=r.filter("[data-form2]");s=s[0]?s.eq(0):r.eq(0);var t=d.getControlName(s,f),u=s.attr("data-form2"),v=r.filter(":checked").val()||"";m(t,v,u,r),n(u,r,t,v,"radio")}}var x=g.selects;return x.each(function(){var b=a(this),c=b.is("[multiple]"),e=b.val();if(c&&(e=e||[]),!l(b)){var g=d.getControlName(b,f),h=b.attr("data-form2");m(g,e,h,b),n(h,b,g,e,c?"select":"")}}),[h,i,j,k]},getControls:function(b){var d=a(this);c("Get controls of form: ",d);var e=d.find("select"),f=d.find("button, input[type=button], input[type=reset], input[type=submit]"),g=d.find(":checkbox"),h=d.find(":radio"),i=d.find("input, textarea").not(f).not(g).not(h);if(b){var j={};g.each(function(){var b=a(this),c=b.attr("name");j[c]=c in j?j[c].add(b):b}),g=j;var k={};h.each(function(){var b=a(this),c=b.attr("name");k[c]=c in k?k[c].add(b):b}),h=k}return{buttons:f,textboxes:i,selects:e,checkboxes:g,radios:h}},applyData:function(b){var d=a(this);c("Apply data for form",b);for(var e in b){var f=d.find("[name="+e+"]"),g=b[e];if(1===f.length)f.is(":checkbox")?g===f.val()&&f.prop("checked",!0):f.val(g);else if(f.length>1)if(a.isArray(g))for(var h=0;h<g.length;h++)f.filter("[value="+g[h]+"]").prop("checked",!0);else f.filter("[value="+g+"]").prop("checked",!0)}return d}};a.fn.form2=function(b){return e[b]?e[b].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof b&&b?void a.error("Method "+b+" does not exist on jquery.form2"):e.init.apply(this,arguments)}}(jQuery);